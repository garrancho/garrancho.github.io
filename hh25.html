<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HH25 Puzzle Validator</title>
  <style>
    :root {
      color-scheme: dark light;
      --accent-dark: #1d1d1f;
      --accent-light: #f6f7fb;
      --highlight: #ff7518;
      --valid-glow: rgba(0, 255, 153, 0.45);
      --invalid-glow: rgba(204, 16, 16, 0.35);
      --invalid: #a00;
      --valid: #0a7a39;
      --neutral: #4d5563;
    }

    body {
      font-family: "Trebuchet MS", Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--accent-light);
      color: var(--accent-dark);
      transition: background-color 0.4s ease, box-shadow 0.4s ease;
    }

    body.empty {
      background: var(--accent-light);
      box-shadow: inset 0 0 0 0 rgba(0, 0, 0, 0);
    }

    body.valid {
      background: #f0fff4;
      box-shadow: inset 0 0 60px 20px var(--valid-glow);
    }

    body.invalid {
      background: #fff5f5;
      box-shadow: inset 0 0 60px 20px var(--invalid-glow);
    }

    header {
      background: #231942;
      color: #fcedff;
      padding: 28px 18px;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.9rem;
      letter-spacing: 0.04em;
    }

    main {
      max-width: 900px;
      margin: 0 auto;
      padding: 32px 18px 60px;
      line-height: 1.6;
    }

    #status-panel {
      margin: 24px auto 32px;
      max-width: 900px;
      padding: 18px 20px;
      border: 2px dashed rgba(35, 25, 66, 0.25);
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.7);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.08);
    }

    .status-line {
      margin: 6px 0;
      font-weight: 600;
    }

    .status-line.invalid {
      color: var(--invalid);
    }

    .status-line.valid {
      color: var(--valid);
    }

    .status-line.empty {
      color: var(--neutral);
    }

    #hash-line {
      font-family: "Courier New", monospace;
      font-weight: 500;
      font-size: 0.95rem;
      word-break: break-all;
      color: inherit;
    }

    .intro {
      margin-bottom: 24px;
      background: rgba(35, 25, 66, 0.07);
      border-radius: 12px;
      padding: 18px 22px;
    }

    .intro p {
      margin: 10px 0;
    }

    fieldset {
      border: 2px solid rgba(35, 25, 66, 0.2);
      border-radius: 12px;
      padding: 18px 24px 22px;
      margin-bottom: 22px;
      background: rgba(255, 255, 255, 0.85);
      box-shadow: 0 4px 9px rgba(0, 0, 0, 0.06);
    }

    legend {
      font-weight: 700;
      color: #2b193d;
      padding: 0 10px;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid rgba(35, 25, 66, 0.25);
      font-size: 1rem;
      box-sizing: border-box;
      margin-bottom: 12px;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .inline-group {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .inline-group label {
      display: flex;
      align-items: center;
      font-weight: 500;
      margin-bottom: 0;
      gap: 6px;
    }

    input[type="color"] {
      padding: 0;
      height: 48px;
      width: 120px;
      cursor: pointer;
    }

    input[type="range"] {
      width: 100%;
      margin: 12px 0;
    }

    small.clue {
      display: block;
      margin-top: -6px;
      margin-bottom: 12px;
      color: #3b2c5a;
      font-style: italic;
    }
  </style>
</head>
<body>
  <header>
    <h1>Checkpoint HH25 &mdash; Hollow Hill Validator</h1>
  </header>

  <section id="status-panel">
    <p id="calculation-line" class="status-line empty">Calculation will appear once you begin.</p>
    <p id="hash-line" class="status-line empty">SHA-256: (awaiting input)</p>
    <p id="status-message" class="status-line empty">The wards slumber. Begin the chant when you are ready.</p>
  </section>

  <main>
    <section class="intro">
      <p>
        HH25 stands between you and the lantern-lit courts of Hollow Hill. The gatekeeper spirit records each response, then
        spins them into a single incantation. Only the correct weave will resonate with the stored hash and bathe the
        checkpoint in emerald light.
      </p>
      <p>
        Follow the Halloween logbook below. Each clue is simple, but the wards demand precision. Supply one answer per prompt
        to pass.
      </p>
    </section>

    <form id="hh25-form" novalidate>
      <fieldset>
        <legend>1. The Gatekeeper</legend>
        <label for="caretaker-name">The caretaker who greets wanderers shares the marrow of the hill itself. Write their name.</label>
        <input type="text" id="caretaker-name" name="caretaker-name" autocomplete="off" placeholder="Caretaker's name">
        <small class="clue">He bows and says, &ldquo;I am Keeper Marrow.&rdquo;</small>
      </fieldset>

      <fieldset>
        <legend>2. Lantern Census</legend>
        <label for="pumpkin-count">Count the carved pumpkins flickering on the fence.</label>
        <input type="number" id="pumpkin-count" name="pumpkin-count" min="0" max="99" placeholder="e.g. 13">
        <small class="clue">Thirteen orange grins line the rail.</small>
      </fieldset>

      <fieldset>
        <legend>3. The Veil's Thinning</legend>
        <label for="veil-date">Mark the date when the veil is thinnest.</label>
        <input type="date" id="veil-date" name="veil-date">
        <small class="clue">The ledger is stamped for 31 October 2024.</small>
      </fieldset>

      <fieldset>
        <legend>4. Lantern Ignition</legend>
        <label for="lantern-time">When do the sky-lanterns ignite?</label>
        <input type="time" id="lantern-time" name="lantern-time">
        <small class="clue">The bells toll at 7:30 PM sharp.</small>
      </fieldset>

      <fieldset>
        <legend>5. Wardlight Hue</legend>
        <label for="moon-color">Choose the color that matches the wardlight shimmering overhead.</label>
        <input type="color" id="moon-color" name="moon-color" value="#ff7518">
        <small class="clue">The wards blaze pumpkin orange (#ff7518).</small>
      </fieldset>

      <fieldset>
        <legend>6. Nocturnal Guide</legend>
        <label for="familiar-select">Select the familiar that volunteers to guide you.</label>
        <select id="familiar-select" name="familiar-select">
          <option value="">Choose...</option>
          <option value="owl">An amber-eyed owl</option>
          <option value="bat">Echo, the leather-winged bat</option>
          <option value="cat">A silent midnight cat</option>
        </select>
        <small class="clue">Echo the bat loops in eager circles.</small>
      </fieldset>

      <fieldset>
        <legend>7. The Safe Path</legend>
        <span>Which path avoids the bog hag's snares?</span>
        <div class="inline-group">
          <label><input type="radio" name="path-choice" value="left"> Left-hand path</label>
          <label><input type="radio" name="path-choice" value="right"> Right-hand path</label>
          <label><input type="radio" name="path-choice" value="through"> Charge straight through</label>
        </div>
        <small class="clue">The log warns, &ldquo;Keep to the left to live.&rdquo;</small>
      </fieldset>

      <fieldset>
        <legend>8. Essential Charms</legend>
        <span>Pack the charms the witches insist upon.</span>
        <div class="inline-group">
          <label><input type="checkbox" name="charms" value="candy-corn"> Pouch of candy corn</label>
          <label><input type="checkbox" name="charms" value="salt"> Silvered salt vial</label>
          <label><input type="checkbox" name="charms" value="silver-bell"> Tinkling silver bell</label>
          <label><input type="checkbox" name="charms" value="moonwater"> Jar of moonwater</label>
        </div>
        <small class="clue">Only the salt and the bell keep the restless shades at bay.</small>
      </fieldset>

      <fieldset>
        <legend>9. Hum of Passage</legend>
        <label for="hum-intensity">Set the hum that steadies the gate (1-13).</label>
        <input type="range" id="hum-intensity" name="hum-intensity" min="1" max="13" value="7">
        <small class="clue">On the margin someone scribbled, &ldquo;Seven keeps the rhythm true.&rdquo;</small>
      </fieldset>

      <fieldset>
        <legend>10. Coven Courier</legend>
        <label for="courier-email">Reach the courier who relays your arrival.</label>
        <input type="email" id="courier-email" name="courier-email" placeholder="name@example.com">
        <small class="clue">Address the note to messenger@midnightpost.com.</small>
      </fieldset>

      <fieldset>
        <legend>11. Signal Rune</legend>
        <label for="signal-phone">Dial the rune-stone's contact number.</label>
        <input type="tel" id="signal-phone" name="signal-phone" placeholder="+1313...">
        <small class="clue">The standing stone bears +1 (313) 555-0113.</small>
      </fieldset>

      <fieldset>
        <legend>12. Safehouse Ledger</legend>
        <label for="safehouse-url">Record the URL of the safehouse record.</label>
        <input type="url" id="safehouse-url" name="safehouse-url" placeholder="https://example.com">
        <small class="clue">The inscription reads https://hollowhill.watch/vein</small>
      </fieldset>

      <fieldset>
        <legend>13. Oath of Entry</legend>
        <label for="oath-text">Recite the pledge whispered at the gate.</label>
        <textarea id="oath-text" name="oath-text" placeholder="Write the oath here."></textarea>
        <small class="clue">Speak clearly: &ldquo;I guard the Hollow Gate.&rdquo;</small>
      </fieldset>

      <fieldset>
        <legend>14. Secret Word</legend>
        <label for="secret-code">Enter the secret code the guardian taught you.</label>
        <input type="password" id="secret-code" name="secret-code" placeholder="Secret code">
        <small class="clue">She whispers the passphrase: spiritkey.</small>
      </fieldset>
    </form>
  </main>

  <script>
    (function () {
      const TARGET_HASH = 'b0a098d57b659825ebf6fcc3d23f775a2279e8cf4bf848d8c61b61e2bbb02379';
      const EMPTY_HASH = '10f4adc9fad19b9a6845f93b52bf4b1a0a7fa7d374bddb1e40d23a80c763669f';
      const STATUS_CLASSES = ['valid', 'invalid', 'empty'];
      const STATUS_MESSAGES = {
        valid: 'The wards harmonize with your incantation. The gate glows green.',
        invalid: 'The wards flare red. Align every detail to spark the true glow.',
        empty: 'The wards slumber. Begin the chant when you are ready.'
      };
      const form = document.getElementById('hh25-form');
      const calculationLine = document.getElementById('calculation-line');
      const hashLine = document.getElementById('hash-line');
      const statusMessage = document.getElementById('status-message');
      const inputs = Array.from(form.querySelectorAll('input, select, textarea'));

      inputs.forEach((element) => {
        const eventName = element.type === 'checkbox' || element.type === 'radio' ? 'change' : 'input';
        element.addEventListener(eventName, updateState);
        if (eventName !== 'input') {
          element.addEventListener('input', updateState);
        }
      });

      updateState();

      async function updateState() {
        const state = collectState();
        const normalized = normalizeState(state);
        const segments = computeSegments(normalized);
        const total = segments.reduce((sum, segment) => sum + segment.value, 0);
        const expression = segments.map((segment) => `${segment.label} ${segment.value}`).join(' + ') + ` = ${total}`;

        calculationLine.textContent = `Calculation: ${expression}`;

        const normalizedString = buildNormalizedString(normalized);
        let hashHex = '';

        try {
          const hashBuffer = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(normalizedString));
          hashHex = bufferToHex(hashBuffer);
        } catch (error) {
          hashHex = 'hash unavailable';
          console.error('Unable to compute hash', error);
        }

        hashLine.textContent = `SHA-256: ${hashHex}`;
        setStatus(determineStatus(hashHex));
      }

      function collectState() {
        const charms = Array.from(form.querySelectorAll('input[name="charms"]:checked')).map((input) => input.value);
        const pathChoice = form.querySelector('input[name="path-choice"]:checked');
        return {
          caretaker: document.getElementById('caretaker-name').value,
          pumpkins: document.getElementById('pumpkin-count').value,
          veilDate: document.getElementById('veil-date').value,
          lanternTime: document.getElementById('lantern-time').value,
          moonColor: document.getElementById('moon-color').value,
          familiar: document.getElementById('familiar-select').value,
          path: pathChoice ? pathChoice.value : '',
          charms,
          hum: document.getElementById('hum-intensity').value,
          courier: document.getElementById('courier-email').value,
          signal: document.getElementById('signal-phone').value,
          safehouse: document.getElementById('safehouse-url').value,
          oath: document.getElementById('oath-text').value,
          secret: document.getElementById('secret-code').value
        };
      }

      function normalizeState(state) {
        return {
          caretaker: sanitizeText(state.caretaker),
          pumpkins: sanitizeNumberString(state.pumpkins),
          veilDate: state.veilDate.trim(),
          lanternTime: state.lanternTime.trim(),
          moonColor: state.moonColor.trim().toLowerCase(),
          familiar: state.familiar.trim().toLowerCase(),
          path: state.path.trim().toLowerCase(),
          charms: sanitizeCharms(state.charms),
          hum: sanitizeNumberString(state.hum),
          courier: sanitizeText(state.courier),
          signal: sanitizeTel(state.signal),
          safehouse: state.safehouse.trim().toLowerCase(),
          oath: state.oath.trim().toLowerCase(),
          secret: state.secret.trim().toLowerCase()
        };
      }

      function buildNormalizedString(normalized) {
        return [
          normalized.caretaker,
          normalized.pumpkins,
          normalized.veilDate,
          normalized.lanternTime,
          normalized.moonColor,
          normalized.familiar,
          normalized.path,
          normalized.charms,
          normalized.hum,
          normalized.courier,
          normalized.signal,
          normalized.safehouse,
          normalized.oath,
          normalized.secret
        ].join('::');
      }

      function computeSegments(normalized) {
        return [
          { label: 'Caretaker', value: stringScore(normalized.caretaker) },
          { label: 'Pumpkins', value: numericScore(normalized.pumpkins) },
          { label: 'Veil Night', value: dateScore(normalized.veilDate) },
          { label: 'Lantern Hour', value: timeScore(normalized.lanternTime) },
          { label: 'Ward Hue', value: colorScore(normalized.moonColor) },
          { label: 'Guide', value: stringScore(normalized.familiar) },
          { label: 'Path', value: stringScore(normalized.path) },
          { label: 'Charms', value: stringScore(normalized.charms) },
          { label: 'Hum', value: numericScore(normalized.hum) },
          { label: 'Courier', value: stringScore(normalized.courier) },
          { label: 'Signal', value: stringScore(normalized.signal) },
          { label: 'Safehouse', value: stringScore(normalized.safehouse) },
          { label: 'Oath', value: stringScore(normalized.oath) },
          { label: 'Secret', value: stringScore(normalized.secret) }
        ];
      }

      function sanitizeText(value) {
        return value ? value.trim().toLowerCase() : '';
      }

      function sanitizeNumberString(value) {
        return value ? value.trim() : '';
      }

      function sanitizeCharms(list) {
        if (!list || list.length === 0) {
          return '';
        }
        return list.slice().sort().join('|').toLowerCase();
      }

      function sanitizeTel(value) {
        if (!value) {
          return '';
        }
        const trimmed = value.trim();
        const hasPlus = trimmed.startsWith('+');
        const digits = trimmed.replace(/[^0-9]/g, '');
        if (!digits) {
          return '';
        }
        return hasPlus ? `+${digits}` : digits;
      }

      function stringScore(text) {
        if (!text) {
          return 0;
        }
        return Array.from(text).reduce((sum, char) => sum + char.charCodeAt(0), 0);
      }

      function numericScore(text) {
        if (!text) {
          return 0;
        }
        const value = Number(text);
        return Number.isFinite(value) ? value : 0;
      }

      function dateScore(text) {
        if (!text) {
          return 0;
        }
        const number = Number(text.replace(/-/g, ''));
        return Number.isFinite(number) ? number : 0;
      }

      function timeScore(text) {
        if (!text) {
          return 0;
        }
        const [hours, minutes] = text.split(':').map(Number);
        if (!Number.isFinite(hours) || !Number.isFinite(minutes)) {
          return 0;
        }
        return hours * 60 + minutes;
      }

      function colorScore(text) {
        if (!text || !text.startsWith('#') || text.length < 4) {
          return 0;
        }
        const parsed = parseInt(text.slice(1), 16);
        return Number.isFinite(parsed) ? parsed : 0;
      }

      function bufferToHex(buffer) {
        return Array.from(new Uint8Array(buffer))
          .map((value) => value.toString(16).padStart(2, '0'))
          .join('');
      }

      function determineStatus(hash) {
        if (hash === TARGET_HASH) {
          return 'valid';
        }
        if (hash === EMPTY_HASH) {
          return 'empty';
        }
        return 'invalid';
      }

      function setStatus(status) {
        STATUS_CLASSES.forEach((cls) => document.body.classList.toggle(cls, cls === status));
        applyStatus(calculationLine, status);
        applyStatus(hashLine, status);
        applyStatus(statusMessage, status);
        statusMessage.textContent = STATUS_MESSAGES[status] || STATUS_MESSAGES.invalid;
      }

      function applyStatus(element, status) {
        STATUS_CLASSES.forEach((cls) => element.classList.toggle(cls, cls === status));
      }
    })();
  </script>
</body>
</html>
